function noPermission(t){1===t.code&&loadDefaultLocs()}function buildWeather(t,e){var a=$("#forecast"+e),o=a.find(".conditions"),n=moment(1e3*t.dt),i=parseInt(t.weatherid),r,c;console.log(i),233>i?(r="storm.jpg",c="rgba(52, 73, 94,1.0)"):i>232&&322>i?(r="rain.jpg",c="rgba(52, 152, 219,1.0)"):i>322&&530>i?(r="heavyrain.jpg",c="rgba(41, 128, 185,1.0)"):i>=600&&622>=i?(r="snow.jpg",c="rgba(127, 140, 141,1.0)"):i>=701&&781>=i?(r="lonelytree.jpg",c="rgba(241, 196, 15,1.0)"):i>=800&&804>=i?(r="valencia.jpg",c="rgba(22, 160, 133,1.0)"):r="valley.jpg",console.log(r),a.fadeTo("fast",0,function(){$(this).css("background-image","url(/images/"+r+")"),$(this).find(".locationTitle").text(t.name).css("color",c),o.find(".city").text(t.name),o.find(".country").text(t.country),o.find(".time").text(n.format("h:mm a"));var e=t.temp.toFixed(0);$(this).find(".temp").text(e),$(this).find(".desc").text(t.desc),$(".fullForecast a").attr("href","http://openweathermap.org/city/"+t.id),$(this).find(".bottomBar, .select-target b").css("background-color",c),$(this).fadeTo("fast",1)})}function toTitleCase(t){return t.replace(/\w\S*/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})}Select.init(),$(document).ready(function(){console.log("loadDefaults"),loadDefaultLocs(),get_location(),$("#locationSelectForm1").on("change blur",function(){getWeatherByCity(this.value,1,buildWeather)}),$("#locationSelectForm2").on("change blur",function(){getWeatherByCity(this.value,2,buildWeather)})});var loadDefaultLocs=function(){getWeatherByCity(2964574,1,buildWeather),getWeatherByCity(2988507,2,buildWeather)},get_location=function(){console.log("asking for location"),Modernizr.geolocation?navigator.geolocation.getCurrentPosition(getWeatherByLatLon,noPermission):loadDefaultLocs()},getWeatherByLatLon=function(t){var e="//api.openweathermap.org/data/2.5/weather?lat="+t.coords.latitude+"&lon="+t.coords.lonitude+"&units=metric",a={};$.getJSON(e,function(t){a.temp=t.main.temp,a.name=t.name,a.country=t.sys.country,a.main=t.weather[0].main,a.desc=toTitleCase(t.weather[0].description),a.dt=t.dt,a.id=t.id,buildWeather(a,1),buildWeather(a,2)})},getWeatherByCity=function(t,e,a){var o="//api.openweathermap.org/data/2.5/weather?id="+t+"&units=metric",n={};$.getJSON(o,function(t){n.temp=t.main.temp,n.name=t.name,n.country=t.sys.country,n.main=t.weather[0].main,n.desc=toTitleCase(t.weather[0].description),n.dt=t.dt,n.id=t.id,n.weatherid=t.weather[0].id,a(n,e)})};