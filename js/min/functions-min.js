function noPermission(e){1===e.code&&loadDefaultLocs()}function buildWeather(e,t){var o=$("#forecast"+t),a=o.find(".conditions"),n=moment(1e3*e.dt),i=parseInt(e.weatherid),r,c;console.log(i),233>i?(r="storm.jpg",c="rgba(52, 73, 94,1.0)"):i>232&&322>i?(r="rain.jpg",c="rgba(52, 152, 219,1.0)"):i>322&&530>i?(r="heavyrain.jpg",c="rgba(41, 128, 185,1.0)"):i>=600&&622>=i?(r="snow.jpg",c="rgba(127, 140, 141,1.0)"):i>=701&&781>=i?(r="lonelytree.jpg",c="rgba(241, 196, 15,1.0)"):i>=800&&804>=i?(r="valencia.jpg",c="rgba(22, 160, 133,1.0)"):r="valley.jpg",console.log(r),o.fadeTo("fast",0,function(){$(this).css("background-image","url(/images/"+r+")"),$(this).find(".locationTitle").text(e.name).css("color",c),a.find(".city").text(e.name),a.find(".country").text(e.country),a.find(".time").text(n.format("h:mm a"));var t=e.temp.toFixed(0);$(this).find(".temp").text(t),$(this).find(".desc").text(e.desc),$(".fullForecast a").attr("href","http://openweathermap.org/city/"+e.id),$(this).find(".bottomBar, .select-target b").css("background-color",c),$(this).fadeTo("fast",1)})}function toTitleCase(e){return e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}Select.init();var select1=new Select({el:document.getElementById("locationSelectForm1")}),select2=new Select({el:document.getElementById("locationSelectForm2")});$(document).ready(function(){console.log("loadDefaults"),loadDefaultLocs(),get_location(),$("#locationSelectForm1").on("change blur",function(){getWeatherByCity(this.value,1,buildWeather)}),$("#locationSelectForm2").on("change blur",function(){getWeatherByCity(this.value,2,buildWeather)})});var loadDefaultLocs=function(){getWeatherByCity(2964574,1,buildWeather),getWeatherByCity(2988507,2,buildWeather)},get_location=function(){console.log("asking for location"),Modernizr.geolocation?navigator.geolocation.getCurrentPosition(getWeatherByLatLon,noPermission):loadDefaultLocs()},getWeatherByLatLon=function(e){var t="//api.openweathermap.org/data/2.5/weather?lat="+e.coords.latitude+"&lon="+e.coords.lonitude+"&units=metric",o={};$.getJSON(t,function(e){o.temp=e.main.temp,o.name=e.name,o.country=e.sys.country,o.main=e.weather[0].main,o.desc=toTitleCase(e.weather[0].description),o.dt=e.dt,o.id=e.id,buildWeather(o,1),buildWeather(o,2)})},getWeatherByCity=function(e,t,o){var a="//api.openweathermap.org/data/2.5/weather?id="+e+"&units=metric",n={};$.getJSON(a,function(e){n.temp=e.main.temp,n.name=e.name,n.country=e.sys.country,n.main=e.weather[0].main,n.desc=toTitleCase(e.weather[0].description),n.dt=e.dt,n.id=e.id,n.weatherid=e.weather[0].id,o(n,t)})};